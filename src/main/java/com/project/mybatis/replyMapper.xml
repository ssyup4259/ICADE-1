<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.mybatis.replyMapper">

<!-- bc_num의 최댓값 -->
<select id="replyMaxNum" resultType="int">
	select nvl(max(BC_NUM), 0) from board_comment
</select>

<insert id="insertData" parameterType="com.project.dto.BoardCommentDTO">
insert into board_comment(BC_NUM,BC_BOARD,BC_ID,BC_DATE,BC_PARENT,BC_CONTENT,BC_IMAGE,BC_SAVEFILENAME) 
values(#{BC_NUM},#{BC_BOARD},#{BC_ID},sysdate,#{BC_PARENT},#{BC_CONTENT},#{BC_IMAGE},#{BC_SAVEFILENAME})
</insert>

<!-- 댓글 리스트 -->
<select id="listData" parameterType="hashMap" resultType="com.project.dto.BoardCommentDTO" >
	SELECT * FROM (SELECT  ROWNUM AS rnum, data.* FROM 
	(SELECT LEVEL,BC_NUM,BC_BOARD,BC_ID,BC_DATE,BC_PARENT,BC_CONTENT,BC_IMAGE,BC_SAVEFILENAME FROM BOARD_COMMENT
	WHERE BC_BOARD = #{BC_BOARD} START WITH BC_PARENT =0
	CONNECT BY NOCYCLE PRIOR BC_NUM = BC_PARENT ORDER SIBLINGS BY BC_NUM DESC) data)
<![CDATA[
	where rnum >= #{start} and rnum <= #{end}
]]>
</select>

<!-- 하나의 데이터 읽어오기 -->
<select id="readData" parameterType="int" resultType="com.project.dto.BoardCommentDTO">
select BC_NUM,BC_BOARD,BC_ID,BC_DATE,BC_PARENT,BC_CONTENT,BC_IMAGE,BC_SAVEFILENAME from board_comment where BC_NUM = #{BC_NUM}
</select>

<!-- 댓글 업데이트 -->
<update id="updateData" parameterType="int">
update board_comment set BC_DATE = sysdate,BC_CONTENT =#{BC_CONTENT},BC_IMAGE =#{BC_IMAGE},BC_SAVEFILENAME=#{BC_SAVEFILENAME} where BC_ID =#{BC_ID}
</update>

<!--  댓글 삭제 -->
<delete id="deleteData" parameterType="int">
delete board_comment where BC_NUM =#{BC_NUM}
</delete>

<!-- 댓글 개수 구하기 -->
<select id="countReply" parameterType="int" resultType="int">
select count(*) from board_comment where BC_BOARD = #{BC_BOARD}
</select>
</mapper>